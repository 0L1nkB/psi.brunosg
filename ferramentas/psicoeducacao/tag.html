<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neurobiologia do TAG | Modelo 3D</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #0f172a; /* Fundo Escuro Moderno */
            --sidebar-width: 300px;
            --text: #e2e8f0;
            --highlight: #38bdf8;
            --panel-bg: rgba(30, 41, 59, 0.9);
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            height: 100vh;
            color: var(--text);
            overflow: hidden;
        }

        /* --- SIDEBAR (Informações) --- */
        aside {
            width: var(--sidebar-width);
            background: #1e293b;
            border-right: 1px solid #334155;
            display: flex;
            flex-direction: column;
            padding: 30px;
            box-shadow: 5px 0 20px rgba(0,0,0,0.5);
            z-index: 10;
        }

        .brand {
            font-size: 1.2rem;
            font-weight: 900;
            color: var(--highlight);
            margin-bottom: 40px;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            animation: fadeIn 0.5s;
        }

        .info-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 15px;
            color: #fff;
            line-height: 1.2;
        }

        .info-desc {
            font-size: 1.05rem;
            line-height: 1.6;
            color: #94a3b8;
        }

        .instructions {
            margin-top: auto;
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.85rem;
            color: #64748b;
        }
        .instructions i { margin-right: 5px; color: var(--highlight); }

        /* --- ÁREA 3D --- */
        main {
            flex: 1;
            position: relative;
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            cursor: move; /* Indica que pode girar */
        }

        #canvas-container {
            width: 100%;
            height: 100%;
        }

        /* Loading */
        #loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; font-size: 1.5rem; pointer-events: none;
        }

        /* Label Flutuante (Tooltip) */
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            transform: translate(-50%, -150%);
            white-space: nowrap;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Responsivo */
        @media (max-width: 900px) {
            body { flex-direction: column; height: 100vh; }
            aside { width: 100%; height: 40%; padding: 20px; box-sizing: border-box; overflow-y: auto; }
            main { height: 60%; }
        }
    </style>
    
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <aside>
        <div class="brand"><i class="fa-solid fa-cube"></i> Neuro3D</div>
        
        <div class="info-panel" id="panel-content">
            <h2 class="info-title" style="color:var(--highlight)">O Cérebro no TAG</h2>
            <p class="info-desc">
                Bem-vindo ao modelo interativo. Aqui vemos o cérebro como um "Raio-X" para entender o que acontece lá dentro na ansiedade.
                <br><br>
                <strong>Gire o modelo</strong> e <strong>clique nas esferas coloridas</strong> para descobrir o papel de cada estrutura.
            </p>
        </div>

        <div class="instructions">
            <div><i class="fa-solid fa-rotate"></i> Clique e arraste para girar</div>
            <div style="margin-top:5px;"><i class="fa-solid fa-arrow-pointer"></i> Clique nas esferas</div>
        </div>
    </aside>

    <main>
        <div id="loading">Carregando Modelo 3D...</div>
        <div id="canvas-container"></div>
        <div id="tooltip"></div>
    </main>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- CONFIGURAÇÃO BÁSICA ---
        const container = document.getElementById('canvas-container');
        const loading = document.getElementById('loading');
        
        // Cena
        const scene = new THREE.Scene();
        // Nevoeiro para dar profundidade
        scene.fog = new THREE.FogExp2(0x0f172a, 0.02);

        // Câmera
        const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(0, 2, 8);

        // Renderizador
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        container.appendChild(renderer.domElement);

        // Controles (Girar)
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 4;
        controls.maxDistance = 12;

        // --- LUZES ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        const pointLight = new THREE.PointLight(0x38bdf8, 2, 20); // Luz azulada
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);
        
        const pointLight2 = new THREE.PointLight(0xff4081, 1, 20); // Luz rosa contrária
        pointLight2.position.set(-5, -2, -5);
        scene.add(pointLight2);

        // --- OBJETOS 3D ---

        // 1. O Cérebro "Fantasma" (Estrutura transparente)
        // Usamos Icosaedro com bastante detalhe para parecer orgânico
        const brainGeometry = new THREE.IcosahedronGeometry(2.2, 2); // Forma base
        const brainMaterial = new THREE.MeshPhysicalMaterial({
            color: 0x94a3b8,
            metalness: 0.1,
            roughness: 0.2,
            transmission: 0.6, // Vidro
            thickness: 1.0,
            transparent: true,
            opacity: 0.3,
            wireframe: false
        });
        
        // Deformar levemente para parecer um cérebro (oval)
        brainGeometry.scale(0.85, 1, 1.2); 
        const brainMesh = new THREE.Mesh(brainGeometry, brainMaterial);
        scene.add(brainMesh);

        // Wireframe sutil por cima para dar aspecto "tech"
        const wireGeo = new THREE.WireframeGeometry(brainGeometry);
        const wireMat = new THREE.LineBasicMaterial({ color: 0x38bdf8, opacity: 0.05, transparent: true });
        const wireframe = new THREE.LineSegments(wireGeo, wireMat);
        brainMesh.add(wireframe);

        // 2. As Estruturas Internas (Esferas Interativas)
        const partsGroup = new THREE.Group();
        scene.add(partsGroup);

        function createOrgan(name, color, position, scale) {
            const geo = new THREE.SphereGeometry(scale, 32, 32);
            const mat = new THREE.MeshStandardMaterial({ 
                color: color, 
                emissive: color,
                emissiveIntensity: 0.8,
                roughness: 0.4,
                metalness: 0.8
            });
            const mesh = new THREE.Mesh(geo, mat);
            mesh.position.set(position.x, position.y, position.z);
            mesh.userData = { name: name, originalScale: scale }; // Dados para interação
            partsGroup.add(mesh);
            
            // Adiciona um brilho (PointLight) na esfera
            const light = new THREE.PointLight(color, 1, 3);
            mesh.add(light);
            
            return mesh;
        }

        // Córtex Pré-Frontal (Na frente/testa) -> Azul
        const cortex = createOrgan('cortex', 0x29b6f6, {x: 0, y: 0.5, z: 1.6}, 0.35);

        // Amígdala (No centro/fundo) -> Vermelho
        const amygdala = createOrgan('amygdala', 0xff5252, {x: 0, y: -0.2, z: 0}, 0.25);

        // Hipocampo (Um pouco atrás/lado) -> Verde
        const hippocampus = createOrgan('hippocampus', 0x66bb6a, {x: 0.8, y: -0.3, z: -0.5}, 0.2);
        // Cria um segundo hipocampo para simetria (apenas visual)
        const hippocampus2 = createOrgan('hippocampus_fake', 0x66bb6a, {x: -0.8, y: -0.3, z: -0.5}, 0.2);


        // --- DADOS DE TEXTO ---
        const infoData = {
            cortex: {
                title: "Córtex Pré-Frontal (O Chefe)",
                desc: "Localizado bem atrás da sua testa. É o CEO do cérebro. Ele planeja, raciocina e diz: 'Calma, está tudo bem'.<br><br>No TAG, ele perde a conexão com a Amígdala e não consegue desligar o alarme de ansiedade."
            },
            amygdala: {
                title: "Amígdala (O Alarme)",
                desc: "O centro primitivo do medo. No TAG, ela é <strong>hiperativa</strong> e pulsa constantemente.<br><br>Ela detecta perigos onde não existem (ex: um e-mail do chefe vira um tigre) e inunda o corpo de adrenalina.",
                highlight: "#ff5252"
            },
            hippocampus: {
                title: "Hipocampo (O Arquivo)",
                desc: "Armazena memórias e contexto. Ele deveria dizer à Amígdala: 'Isso já aconteceu antes e ficamos bem'.<br><br>O estresse crônico pode 'murchar' essa área, dificultando diferenciar uma lembrança ruim de um perigo real agora."
            },
            hippocampus_fake: { // Cópia do texto acima
                title: "Hipocampo (O Arquivo)",
                desc: "Armazena memórias e contexto. Ele deveria dizer à Amígdala: 'Isso já aconteceu antes e ficamos bem'.<br><br>O estresse crônico pode 'murchar' essa área, dificultando diferenciar uma lembrança ruim de um perigo real agora."
            }
        };

        // --- INTERAÇÃO (RAYCASTER) ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        const tooltip = document.getElementById('tooltip');
        const panelTitle = document.querySelector('.info-title');
        const panelDesc = document.querySelector('.info-desc');

        // Evento de movimento do mouse (para tooltip e hover)
        window.addEventListener('mousemove', (event) => {
            // Normalizar coordenadas do mouse (-1 a +1)
            const rect = renderer.domElement.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

            // Mover tooltip
            tooltip.style.left = event.clientX + 'px';
            tooltip.style.top = event.clientY + 'px';
            
            checkIntersection();
        });

        // Evento de clique
        window.addEventListener('click', () => {
            if (hoveredObj) {
                updateInfoPanel(hoveredObj.userData.name);
                
                // Efeito de "pulso" ao clicar
                const scale = hoveredObj.userData.originalScale;
                hoveredObj.scale.set(1.5, 1.5, 1.5);
                setTimeout(() => hoveredObj.scale.set(1, 1, 1), 200);
            }
        });

        let hoveredObj = null;

        function checkIntersection() {
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(partsGroup.children);

            if (intersects.length > 0) {
                const object = intersects[0].object;
                
                if (hoveredObj !== object) {
                    // Reset anterior
                    if (hoveredObj) hoveredObj.scale.set(1, 1, 1);
                    
                    hoveredObj = object;
                    document.body.style.cursor = 'pointer';
                    
                    // Highlight atual
                    hoveredObj.scale.set(1.2, 1.2, 1.2);
                    
                    // Tooltip
                    let key = hoveredObj.userData.name;
                    // Tratamento para nome amigável
                    let label = key === 'cortex' ? 'Córtex' : (key === 'amygdala' ? 'Amígdala' : 'Hipocampo');
                    
                    tooltip.innerText = label;
                    tooltip.style.opacity = 1;
                }
            } else {
                if (hoveredObj) {
                    hoveredObj.scale.set(1, 1, 1);
                    hoveredObj = null;
                    document.body.style.cursor = 'move';
                    tooltip.style.opacity = 0;
                }
            }
        }

        function updateInfoPanel(key) {
            const data = infoData[key];
            if(!data) return;

            // Efeito de fade no texto
            const panel = document.getElementById('panel-content');
            panel.style.opacity = 0;
            
            setTimeout(() => {
                panelTitle.innerText = data.title;
                panelDesc.innerHTML = data.desc;
                if(data.highlight) panelTitle.style.color = data.highlight;
                else panelTitle.style.color = '#38bdf8'; // volta pro azul padrão
                panel.style.opacity = 1;
            }, 300);
        }

        // --- LOOP DE ANIMAÇÃO ---
        function animate() {
            requestAnimationFrame(animate);
            
            controls.update();

            // Pulso da Amígdala (Bater como coração)
            const time = Date.now() * 0.005;
            const pulse = 1 + Math.sin(time * 2) * 0.1; // Ritmo
            amygdala.scale.set(pulse, pulse, pulse);

            // Rotação leve automática do cérebro fantasma
            brainMesh.rotation.y += 0.001;
            // As partes internas acompanham a rotação global se estiverem dentro do mesh?
            // Não, elas estão em grupo separado. Vamos girar o grupo todo para ficar sincronizado
            // Se quisermos que tudo gire junto, colocamos as parts DENTRO do brainMesh.
            // Vamos fazer isso agora para corrigir a sincronia.
        }
        
        // Ajuste de hierarquia para rotação conjunta
        brainMesh.add(partsGroup);

        // Remover loading
        loading.style.display = 'none';

        animate();

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });

    </script>
</body>
</html>
