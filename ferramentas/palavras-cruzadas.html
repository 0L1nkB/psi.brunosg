<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cruzadinha Cl√≠nica DSM-5 | Bruno de Souza</title>
    
    <script>
        if(localStorage.getItem('logado') !== 'sim') {
            window.location.href = "../../login.html";
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* [MANTENDO O DESIGN PADR√ÉO APROVADO] */
        :root {
            --primary: #2c3e50;
            --accent: #e67e22;
            --bg-body: #ecf0f1;
            --card-bg: #ffffff;
            --text-main: #2c3e50;
            --text-light: #7f8c8d;
            --cell-size: 34px; /* Levemente menor para caber grids maiores */
            --cell-blocked: #2d3436;
            --correct-bg: #27ae60;
            --wrong-bg: #c0392b;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0; padding: 20px;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        header {
            background: var(--card-bg); padding: 20px 40px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); text-align: center;
            width: 100%; max-width: 1200px; margin-bottom: 20px;
            border-bottom: 5px solid var(--accent); position: relative;
        }

        header h1 { margin: 0; color: var(--primary); font-size: 1.8rem; font-weight: 800; text-transform: uppercase; }
        .subtitle { color: var(--text-light); font-weight: 600; margin-top: 5px; }

        .btn-print {
            position: absolute; top: 25px; right: 30px;
            background: transparent; border: 2px solid var(--primary); color: var(--primary);
            padding: 8px 20px; border-radius: 30px; font-weight: 700; cursor: pointer; transition: 0.3s;
        }
        .btn-print:hover { background: var(--primary); color: white; }

        .control-panel {
            width: 100%; max-width: 1200px; background: var(--card-bg);
            padding: 15px; border-radius: 15px; margin-bottom: 20px;
            display: flex; gap: 15px; align-items: center; flex-wrap: wrap;
            box-shadow: 0 5px 15px rgba(0,0,0,0.03);
        }

        .select-wrapper { flex: 2; min-width: 300px; }
        select {
            width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #dfe6e9;
            font-family: inherit; font-size: 0.95rem; font-weight: 700; color: var(--text-main);
            cursor: pointer;
        }

        .btn-game {
            padding: 10px 20px; border-radius: 10px; border: none; cursor: pointer;
            font-weight: 800; color: white; display: flex; align-items: center; gap: 8px;
            transition: transform 0.2s;
        }
        .btn-game:hover { transform: translateY(-2px); }
        
        .btn-check { background: #27ae60; }
        .btn-answers { background: #f39c12; }
        .btn-new { background: var(--primary); }

        .game-layout {
            display: grid; grid-template-columns: auto 320px; gap: 20px;
            width: 100%; max-width: 1300px; align-items: start;
        }

        .grid-wrapper {
            background: var(--primary); padding: 10px; border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: auto; display: flex; justify-content: center; align-items: center;
            min-height: 500px; position: relative;
        }

        #crosswordGrid {
            display: grid; gap: 1px; background: var(--cell-blocked); border: 5px solid var(--cell-blocked);
        }

        .cell {
            width: var(--cell-size); height: var(--cell-size);
            background: var(--cell-blocked); position: relative;
        }

        .cell.active { background: #fff; }

        .cell input {
            width: 100%; height: 100%; border: none; text-align: center;
            font-family: 'Quicksand', sans-serif; font-weight: 800; font-size: 1.1rem;
            text-transform: uppercase; color: var(--text-main); background: transparent;
            padding: 0; outline: none; cursor: text;
        }
        
        .cell input:focus { background: #e3f2fd; }
        .cell.correct input { background: #e0f7fa; color: var(--correct-bg); }
        .cell.wrong input { background: #ffebee; color: var(--wrong-bg); }

        .cell-num {
            position: absolute; top: 1px; left: 2px; font-size: 8px;
            color: var(--primary); font-weight: 800; pointer-events: none;
        }

        .clues-panel {
            background: white; border-radius: 15px; padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); height: 600px;
            display: flex; flex-direction: column;
        }

        .clues-content { flex: 1; overflow-y: auto; padding-right: 5px; }
        
        .clue-group-title {
            color: var(--primary); border-bottom: 2px solid #eee; margin: 15px 0 5px 0;
            font-weight: 800; font-size: 0.9rem; text-transform: uppercase;
        }
        
        .clue-item {
            padding: 6px 8px; margin-bottom: 5px; cursor: pointer; font-size: 0.85rem;
            border-left: 3px solid transparent; transition: 0.2s;
        }
        .clue-item:hover { background: #f7f9fa; border-left-color: var(--accent); }
        
        /* Modal Gabarito */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000; display: none;
            align-items: center; justify-content: center;
        }
        .modal-box {
            background: white; width: 90%; max-width: 500px; max-height: 80vh;
            border-radius: 15px; padding: 25px; overflow-y: auto;
        }

        @media (max-width: 900px) {
            .game-layout { grid-template-columns: 1fr; }
            .grid-wrapper { min-height: 400px; }
            .clues-panel { height: auto; max-height: 300px; }
            .btn-print span { display: none; }
        }

        @media print {
            header button, .control-panel { display: none !important; }
            .game-layout { display: block; }
            .grid-wrapper { box-shadow: none; padding: 0; background: transparent; }
            .crossword-grid { border: 2px solid #000; background: #000; }
            .cell { border: 1px solid #000; background: #000; }
            .cell.active { background: white !important; }
            .cell input { color: transparent !important; }
            .clues-panel { box-shadow: none; height: auto; border: 1px solid #ccc; margin-top: 20px; }
        }
    </style>
</head>
<body>

    <header>
        <button class="btn-print" onclick="window.print()"><i class="fa-solid fa-print"></i> <span>Imprimir</span></button>
        <h1>Cruzadinha Cl√≠nica DSM-5</h1>
        <div class="subtitle">Exerc√≠cio de Psicoeduca√ß√£o e Fixa√ß√£o de Sintomas</div>
    </header>

    <div class="control-panel">
        <div class="select-wrapper">
            <select id="levelSelect" onchange="generateGame()">
                <optgroup label="Neurodesenvolvimento">
                    <option value="tea">Transtorno do Espectro Autista (TEA)</option>
                    <option value="tdah">TDAH</option>
                </optgroup>
                <optgroup label="Espectro da Esquizofrenia">
                    <option value="esquizofrenia">Esquizofrenia</option>
                </optgroup>
                <optgroup label="Humor">
                    <option value="bipolar">Transtorno Bipolar</option>
                    <option value="depressao">Transtorno Depressivo Maior</option>
                    <option value="tdpm">Disf√≥rico Pr√©-Menstrual</option>
                </optgroup>
                <optgroup label="Ansiedade">
                    <option value="ans_separacao">Ansiedade de Separa√ß√£o</option>
                    <option value="ans_social">Ansiedade Social (Fobia)</option>
                    <option value="panico">Transtorno do P√¢nico</option>
                    <option value="agorafobia">Agorafobia</option>
                    <option value="tag">Ansiedade Generalizada (TAG)</option>
                </optgroup>
                <optgroup label="Obsessivo-Compulsivo">
                    <option value="toc">TOC</option>
                    <option value="dismorfico">Dism√≥rfico Corporal</option>
                    <option value="acumulacao">Acumula√ß√£o</option>
                    <option value="tricotilomania">Tricotilomania</option>
                </optgroup>
                <optgroup label="Trauma e Estresse">
                    <option value="apego_reativo">Apego Reativo</option>
                    <option value="tept">TEPT (P√≥s-Traum√°tico)</option>
                    <option value="estresse_agudo">Estresse Agudo</option>
                </optgroup>
                <optgroup label="Alimentares">
                    <option value="pica">Pica</option>
                    <option value="ruminacao">Rumina√ß√£o</option>
                    <option value="arfid">Restritivo/Evitativo (ARFID)</option>
                    <option value="anorexia">Anorexia Nervosa</option>
                    <option value="bulimia">Bulimia Nervosa</option>
                    <option value="compulsao_alim">Compuls√£o Alimentar</option>
                </optgroup>
                <optgroup label="Sono-Vig√≠lia">
                    <option value="insonia">Ins√¥nia</option>
                    <option value="hipersonolencia">Hipersonol√™ncia</option>
                    <option value="narcolepsia">Narcolepsia</option>
                </optgroup>
                <optgroup label="Disruptivos e Conduta">
                    <option value="tod">Opositivo Desafiador (TOD)</option>
                    <option value="explosivo">Explosivo Intermitente</option>
                    <option value="conduta">Transtorno da Conduta</option>
                    <option value="piromania">Piromania</option>
                    <option value="cleptomania">Cleptomania</option>
                </optgroup>
                <optgroup label="Personalidade (Cluster A)">
                    <option value="paranoide">Paranoide</option>
                    <option value="esquizoide">Esquizoide</option>
                    <option value="esquizotipica">Esquizot√≠pica</option>
                </optgroup>
                <optgroup label="Personalidade (Cluster B)">
                    <option value="antissocial">Antissocial</option>
                    <option value="borderline">Borderline</option>
                    <option value="histrionica">Histri√¥nica</option>
                    <option value="narcisista">Narcisista</option>
                </optgroup>
                <optgroup label="Personalidade (Cluster C)">
                    <option value="evitativa">Evitativa</option>
                    <option value="dependente">Dependente</option>
                    <option value="ob_compulsiva">Obsessivo-Compulsiva (TPOC)</option>
                </optgroup>
            </select>
        </div>

        <button class="btn-game btn-new" onclick="generateGame()">
            <i class="fa-solid fa-shuffle"></i> Gerar Novo
        </button>
        <button class="btn-game btn-check" onclick="checkGame()">
            <i class="fa-solid fa-check"></i> Verificar
        </button>
        <button class="btn-game btn-answers" onclick="showAnswers()">
            <i class="fa-solid fa-key"></i> Gabarito
        </button>
    </div>

    <div class="game-layout">
        <div class="grid-wrapper">
            <div id="crosswordGrid"></div>
        </div>

        <div class="clues-panel">
            <div class="clues-content">
                <div class="clue-group-title">Horizontais</div>
                <div id="listH"></div>
                <div class="clue-group-title" style="margin-top:20px;">Verticais</div>
                <div id="listV"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="modalAnswers">
        <div class="modal-box">
            <h2 style="margin-top:0; color:var(--primary)">Gabarito</h2>
            <div id="answersList"></div>
            <button class="btn-game btn-new" style="margin-top:20px; width:100%; justify-content:center;" onclick="document.getElementById('modalAnswers').style.display='none'">Fechar</button>
        </div>
    </div>

    <center>
        <a href="../listaferramentas.html" style="display:inline-block; margin-top:40px; color:#b2bec3; text-decoration:none; font-weight:600;" class="btn-back-home">
            <i class="fa-solid fa-arrow-left"></i> Voltar
        </a>
    </center>

    <script>
        // ============================================
        // üìö BANCO DE DADOS GRANULAR (DSM-5)
        // ============================================
        const DB = {
            // NEURO
            tea: [
                {t:"ECOLALIA", d:"Repeti√ß√£o de falas."}, {t:"ROTINA", d:"Apego excessivo a padr√µes."}, {t:"HIPERFOCO", d:"Interesse restrito e intenso."},
                {t:"SENSORIAL", d:"Hipersensibilidade a est√≠mulos."}, {t:"ISOLAMENTO", d:"Dificuldade na intera√ß√£o social."}, {t:"LITERAL", d:"Dificuldade com met√°foras."},
                {t:"RIGIDEZ", d:"Inflexibilidade cognitiva."}, {t:"ESTEREO", d:"Movimentos repetitivos (ex: flapping)."}, {t:"CONTATO", d:"Evita olhar nos olhos."}, {t:"ATIPICO", d:"Desenvolvimento n√£o usual."}
            ],
            tdah: [
                {t:"DESATENCAO", d:"Dificuldade em manter o foco."}, {t:"IMPULSO", d:"Agir sem pensar."}, {t:"HIPERATIVO", d:"Agita√ß√£o motora excessiva."},
                {t:"ESQUECER", d:"Perde objetos com frequ√™ncia."}, {t:"INTERROMPER", d:"Fala por cima dos outros."}, {t:"INQUIETO", d:"N√£o consegue ficar parado."},
                {t:"ERROS", d:"Comete falhas por descuido."}, {t:"MENTAL", d:"Evita esfor√ßo cognitivo sustentado."}, {t:"PRAZO", d:"Dificuldade com gest√£o de tempo."}, {t:"FOCO", d:"Dificuldade em detalhes."}
            ],
            // ESQUIZOFRENIA
            esquizofrenia: [
                {t:"DELIRIO", d:"Cren√ßa falsa e fixa."}, {t:"ALUCINACAO", d:"Ver/ouvir o que n√£o existe."}, {t:"DESORGANIZA", d:"Discurso ou comportamento confuso."},
                {t:"CATATONIA", d:"Imobilidade ou agita√ß√£o."}, {t:"NEGATIVOS", d:"Sintomas como apatia e abulia."}, {t:"AFETO", d:"Embotamento emocional."},
                {t:"PARANOIA", d:"Sentimento de persegui√ß√£o."}, {t:"SURTO", d:"Quebra com a realidade."}, {t:"LOGICA", d:"Falha no racioc√≠nio."}, {t:"SOCIAL", d:"Retraimento intenso."}
            ],
            // HUMOR
            bipolar: [
                {t:"MANIA", d:"Fase de euforia extrema."}, {t:"DEPRESSAO", d:"Fase de tristeza profunda."}, {t:"GRANDEZA", d:"Sentimento de poder infinito."},
                {t:"SONO", d:"Necessidade diminu√≠da de dormir."}, {t:"FALA", d:"Press√£o para falar (verborragia)."}, {t:"RISCO", d:"Comportamentos perigosos."},
                {t:"COMPRAS", d:"Gastos excessivos na mania."}, {t:"IDEIAS", d:"Fuga de pensamentos."}, {t:"LITIO", d:"Estabilizador de humor comum."}, {t:"MISTO", d:"Sintomas misturados."}
            ],
            depressao: [
                {t:"TRISTEZA", d:"Humor deprimido na maior parte do dia."}, {t:"ANEDONIA", d:"Perda de prazer nas atividades."}, {t:"PESO", d:"Ganho ou perda significativa."},
                {t:"INSONIA", d:"Dificuldade de sono."}, {t:"CULPA", d:"Sentimento de inutilidade excessiva."}, {t:"FADIGA", d:"Perda de energia di√°ria."},
                {t:"CONCENTRA", d:"Indecis√£o ou falta de foco."}, {t:"MORTE", d:"Pensamentos recorrentes sobre o fim."}, {t:"LENTIDAO", d:"Retardo psicomotor."}, {t:"VAZIO", d:"Sensa√ß√£o interna descrita."}
            ],
            // ANSIEDADE
            panico: [
                {t:"CORACAO", d:"Taquicardia ou palpita√ß√µes."}, {t:"SUOR", d:"Sudorese intensa."}, {t:"TREMOR", d:"Abalos musculares."},
                {t:"AR", d:"Sensa√ß√£o de falta de ar."}, {t:"DOR", d:"Desconforto no peito."}, {t:"NAUSEA", d:"Desconforto abdominal."},
                {t:"TONTURA", d:"Instabilidade ou desmaio."}, {t:"REALIDADE", d:"Desrealiza√ß√£o (irrealidade)."}, {t:"CONTROLE", d:"Medo de enlouquecer."}, {t:"MORTE", d:"Medo iminente de morrer."}
            ],
            tag: [
                {t:"PREOCUPA", d:"Expectativa apreensiva excessiva."}, {t:"CONTROLE", d:"Dificuldade em controlar a preocupa√ß√£o."}, {t:"NERVOS", d:"Inquieta√ß√£o ou 'nervos √† flor da pele'."},
                {t:"CANSACO", d:"Fadigabilidade f√°cil."}, {t:"BRANCO", d:"Dificuldade de concentrar a mente."}, {t:"IRRITA", d:"Irritabilidade f√°cil."},
                {t:"TENSAO", d:"Rigidez muscular."}, {t:"SONO", d:"Perturba√ß√£o do descanso."}, {t:"FUTURO", d:"Foco excessivo no 'e se'."}, {t:"SOMATIZA", d:"Sintomas f√≠sicos diversos."}
            ],
            // TOC
            toc: [
                {t:"OBSESSAO", d:"Pensamento intrusivo e indesejado."}, {t:"COMPULSAO", d:"Ato repetitivo para aliviar ansiedade."}, {t:"LIMPEZA", d:"Lavagem excessiva."},
                {t:"SIMETRIA", d:"Necessidade de ordem perfeita."}, {t:"VERIFICA", d:"Checar portas/g√°s repetidamente."}, {t:"CONTAGEM", d:"Contar objetos mentalmente."},
                {t:"DUVIDA", d:"Incerteza patol√≥gica."}, {t:"RITUAL", d:"Regras r√≠gidas de execu√ß√£o."}, {t:"ALIVIO", d:"Sensa√ß√£o tempor√°ria p√≥s-ritual."}, {t:"TEMPO", d:"Consome mais de 1h por dia."}
            ],
            // TRAUMA
            tept: [
                {t:"FLASHBACK", d:"Reviver o evento traumatico."}, {t:"PESADELO", d:"Sonhos angustiantes recorrentes."}, {t:"EVITACAO", d:"Fugir de est√≠mulos associados."},
                {t:"HUMOR", d:"Estado emocional negativo persistente."}, {t:"ALERTA", d:"Hipervigil√¢ncia constante."}, {t:"SUSTO", d:"Sobressalto exagerado."},
                {t:"MEMORIA", d:"Amn√©sia de partes do trauma."}, {t:"CULPA", d:"Distor√ß√£o cognitiva sobre a causa."}, {t:"SONO", d:"Dificuldade para dormir."}, {t:"RAIVA", d:"Explos√µes de agressividade."}
            ],
            // ALIMENTAR
            anorexia: [
                {t:"RESTRICAO", d:"Baixa ingest√£o energ√©tica."}, {t:"PESO", d:"Medo intenso de engordar."}, {t:"DISTORCAO", d:"Perturba√ß√£o na imagem corporal."},
                {t:"JEJUM", d:"Ficar longos per√≠odos sem comer."}, {t:"EXERCICIO", d:"Atividade f√≠sica excessiva."}, {t:"CONTROLE", d:"Obsess√£o por dominar o corpo."},
                {t:"NEGACAO", d:"N√£o reconhece a gravidade do baixo peso."}, {t:"CALORIA", d:"Contagem obsessiva."}, {t:"RITUAL", d:"Cortar comida em peda√ßos min√∫sculos."}, {t:"IMC", d:"√çndice de massa corporal baixo."}
            ],
            // PERSONALIDADE B
            borderline: [
                {t:"ABANDONO", d:"Esfor√ßo fren√©tico para evit√°-lo."}, {t:"INSTAVEL", d:"Relacionamentos intensos e ca√≥ticos."}, {t:"IDENTIDADE", d:"Autoimagem perturbada."},
                {t:"IMPULSO", d:"Gastos, sexo, abuso de subst√¢ncias."}, {t:"SUICIDIO", d:"Comportamento ou amea√ßas recorrentes."}, {t:"HUMOR", d:"Instabilidade afetiva acentuada."},
                {t:"VAZIO", d:"Sentimento cr√¥nico interior."}, {t:"RAIVA", d:"Dificuldade em controlar a f√∫ria."}, {t:"PARANOIA", d:"Idea√ß√£o transit√≥ria sob estresse."}, {t:"DISSOCIA", d:"Sintomas de desligamento da realidade."}
            ],
            narcisista: [
                {t:"GRANDEZA", d:"Senso inflado de import√¢ncia."}, {t:"FANTASIA", d:"Sucesso, poder ou beleza ilimitados."}, {t:"ESPECIAL", d:"Cren√ßa de ser √∫nico."},
                {t:"ADMIRACAO", d:"Necessidade excessiva de ser louvado."}, {t:"DIREITO", d:"Intitula√ß√£o: esperar tratamento VIP."}, {t:"EXPLORA", d:"Usa os outros para fins pr√≥prios."},
                {t:"EMPATIA", d:"Falta de capacidade de se colocar no lugar do outro."}, {t:"INVEJA", d:"Cr√™ que os outros o invejam."}, {t:"ARROGANTE", d:"Comportamentos altivos."}, {t:"SUPERIOR", d:"Sentimento de estar acima da m√©dia."}
            ],
            // Preenchimento de fallback para categorias restantes com palavras gen√©ricas do grupo
            tdpm: [{t:"IRRITA", d:"Sintoma afetivo."}, {t:"MAMA", d:"Sensibilidade f√≠sica."}, {t:"INCHACO", d:"Sintoma f√≠sico."}, {t:"HUMOR", d:"Labilidade."}, {t:"ANSIEDADE", d:"Tens√£o."}],
            ans_separacao: [{t:"AFASTAMENTO", d:"Medo de sair de casa."}, {t:"PERDA", d:"Medo de perder figuras de apego."}, {t:"PESADELO", d:"Sonhos sobre separa√ß√£o."}, {t:"CAMA", d:"Recusa em dormir fora."}],
            ans_social: [{t:"JULGAMENTO", d:"Medo de avalia√ß√£o negativa."}, {t:"VERGONHA", d:"Medo de humilha√ß√£o."}, {t:"PUBLICO", d:"Medo de falar."}, {t:"TREMER", d:"Sintoma f√≠sico."}],
            agorafobia: [{t:"MULTIDAO", d:"Local temido."}, {t:"FILA", d:"Situa√ß√£o temida."}, {t:"SAIR", d:"Dificuldade de sair de casa."}, {t:"SOCORRO", d:"Medo de n√£o ter ajuda."}],
            dismorfico: [{t:"DEFEITO", d:"Foco em falha percebida."}, {t:"ESPELHO", d:"Verifica√ß√£o excessiva."}, {t:"CAMUFLAR", d:"Tentar esconder."}, {t:"FEIO", d:"Autoimagem negativa."}],
            acumulacao: [{t:"GUARDAR", d:"Dificuldade de descartar."}, {t:"BAGUNCA", d:"Ac√∫mulo f√≠sico."}, {t:"ANGUSTIA", d:"Sofrimento ao jogar fora."}, {t:"VALOR", d:"Atribui√ß√£o excessiva aos objetos."}],
            tricotilomania: [{t:"ARRANCAR", d:"A√ß√£o principal."}, {t:"CABELO", d:"Alvo comum."}, {t:"PRAZER", d:"Sensa√ß√£o p√≥s-ato."}, {t:"FALHA", d:"Perda capilar vis√≠vel."}],
            apego_reativo: [{t:"INIBIDO", d:"Comportamento social."}, {t:"CONFORTO", d:"N√£o busca quando angustiado."}, {t:"MEDO", d:"Afeto negativo inexplicado."}, {t:"CUIDADOR", d:"Falha na rela√ß√£o."}],
            estresse_agudo: [{t:"TRAUMA", d:"Exposi√ß√£o a evento."}, {t:"INTRUSAO", d:"Mem√≥rias invadem."}, {t:"HUMOR", d:"Incapacidade de felicidade."}, {t:"DIAS", d:"Dura√ß√£o de 3 a 30 dias."}],
            pica: [{t:"INGESTAO", d:"Comer o que n√£o √© alimento."}, {t:"TERRA", d:"Exemplo de subst√¢ncia."}, {t:"GELO", d:"Pagofagia."}, {t:"TINTA", d:"Risco de toxicidade."}],
            ruminacao: [{t:"REGURGITA", d:"Volta do alimento."}, {t:"REPETIDA", d:"Acontece frequentemente."}, {t:"ENGOLE", d:"Reingest√£o."}, {t:"NAUSEA", d:"Aus√™ncia de problema gastro."}],
            arfid: [{t:"RESTRITO", d:"Limita√ß√£o alimentar."}, {t:"TEXTURA", d:"Avers√£o sensorial."}, {t:"ENGASGO", d:"Medo de consequ√™ncias."}, {t:"NUTRICAO", d:"Defici√™ncia."}],
            bulimia: [{t:"COMPULSAO", d:"Comer muito r√°pido."}, {t:"VOMITO", d:"Comportamento compensat√≥rio."}, {t:"FORMA", d:"Influ√™ncia na autoavalia√ß√£o."}, {t:"LAXANTE", d:"Uso indevido."}],
            compulsao_alim: [{t:"DESCONTROLE", d:"Sensa√ß√£o durante o epis√≥dio."}, {t:"RAPIDO", d:"Comer velozmente."}, {t:"ESCONDIDO", d:"Comer por vergonha."}, {t:"CULPA", d:"Sentimento posterior."}],
            insonia: [{t:"INICIAR", d:"Dificuldade ao deitar."}, {t:"MANTER", d:"Acordar no meio da noite."}, {t:"PRECOCE", d:"Acordar muito cedo."}, {t:"CANSACO", d:"Preju√≠zo diurno."}],
            hipersonolencia: [{t:"EXCESSIVO", d:"Sono prolongado."}, {t:"COCHILO", d:"Dorme de dia."}, {t:"CONFUSAO", d:"Ao acordar (embriaguez do sono)."}, {t:"RESTAURA", d:"Sono n√£o descansa."}],
            narcolepsia: [{t:"ATAQUE", d:"Sono irresist√≠vel."}, {t:"CATAPLEXIA", d:"Perda de t√¥nus muscular."}, {t:"REM", d:"Entrada r√°pida no sono."}, {t:"ALUCINA", d:"Hipnag√≥gicas."}],
            tod: [{t:"RAIVA", d:"Humor irrit√°vel."}, {t:"DISCUTE", d:"Comportamento questionador."}, {t:"DESAFIA", d:"Recusa regras."}, {t:"VINGATIVO", d:"Rancoroso."}],
            explosivo: [{t:"AGRESSAO", d:"Verbal ou f√≠sica."}, {t:"DESPROPORCIONAL", d:"Rea√ß√£o exagerada."}, {t:"IMPULSO", d:"N√£o premeditado."}, {t:"REMORSO", d:"Arrependimento posterior."}],
            conduta: [{t:"AGRESSAO", d:"A pessoas ou animais."}, {t:"DESTRUICAO", d:"De propriedade."}, {t:"MENTIRA", d:"Ou furto."}, {t:"REGRAS", d:"Viola√ß√£o grave."}],
            piromania: [{t:"FOGO", d:"Atear intencionalmente."}, {t:"FASCINIO", d:"Atra√ß√£o por inc√™ndios."}, {t:"TENSAO", d:"Antes do ato."}, {t:"PRAZER", d:"Durante o ato."}],
            cleptomania: [{t:"FURTO", d:"Roubar objetos desnecess√°rios."}, {t:"IMPULSO", d:"Incapacidade de resistir."}, {t:"ALIVIO", d:"Ap√≥s o furto."}, {t:"CULPA", d:"Sentimento comum depois."}],
            substancias: [{t:"TOLERANCIA", d:"Precisa de mais dose."}, {t:"ABSTINENCIA", d:"Sintomas na falta."}, {t:"CRAVING", d:"Fissura/Desejo."}, {t:"CONTROLE", d:"Uso maior que o planejado."}],
            jogo: [{t:"APOSTAR", d:"Dinheiro crescente."}, {t:"IRRITADO", d:"Ao tentar parar."}, {t:"RECUPERAR", d:"Voltar para ganhar o perdido."}, {t:"MENTIR", d:"Esconder o envolvimento."}],
            paranoide: [{t:"SUSPEITA", d:"Desconfian√ßa sem base."}, {t:"LEALDADE", d:"D√∫vida sobre amigos."}, {t:"RENCOR", d:"N√£o perdoa insultos."}, {t:"AMEACA", d:"V√™ perigo onde n√£o h√°."}],
            esquizoide: [{t:"DISTANTE", d:"N√£o deseja rela√ß√µes."}, {t:"SOLITARIO", d:"Prefere atividades s√≥s."}, {t:"PRAZER", d:"Pouco interesse sexual."}, {t:"INDIFERENTE", d:"A elogios ou cr√≠ticas."}],
            esquizotipica: [{t:"REFERENCIA", d:"Ideias de que tudo √© para si."}, {t:"ESTRANHO", d:"Pensamento ou discurso."}, {t:"ILUSAO", d:"Percep√ß√µes corporais."}, {t:"PARANOIA", d:"Suspeita social."}],
            antissocial: [{t:"LEI", d:"Incapacidade de ajustar-se."}, {t:"MENTIRA", d:"Enganar para ganho."}, {t:"IMPULSO", d:"Fracasso em planejar."}, {t:"REMORSO", d:"Indiferen√ßa ao ferir."}],
            histrionica: [{t:"CENTRO", d:"Desconforto se n√£o for o foco."}, {t:"SEDUTOR", d:"Comportamento sexual inadequado."}, {t:"EMOCAO", d:"Mudan√ßa r√°pida e superficial."}, {t:"FISICO", d:"Usa apar√™ncia para chamar aten√ß√£o."}],
            evitativa: [{t:"REJEICAO", d:"Medo excessivo."}, {t:"ENVERGONHAR", d:"Medo de passar vergonha."}, {t:"INIBIDO", d:"Em situa√ß√µes novas."}, {t:"INFERIOR", d:"Se v√™ como socialmente inapto."}],
            dependente: [{t:"CONSELHO", d:"Precisa para decis√µes simples."}, {t:"RESPONSAVEL", d:"Outros assumem a vida."}, {t:"DISCORDAR", d:"Medo de perder apoio."}, {t:"SOZINHO", d:"Desconforto ao estar s√≥s."}],
            ob_compulsiva: [{t:"DETALHE", d:"Foco em listas e ordem."}, {t:"PERFEITO", d:"Interfere na conclus√£o."}, {t:"TRABALHO", d:"Dedica√ß√£o excessiva."}, {t:"RIGIDO", d:"Teimosia moral."}]
        };

        const GRID_SIZE = 15;
        let gridArray = [];
        let placedWords = [];

        function generateGame() {
            const category = document.getElementById('categorySelect').value;
            // Fallback para arrays menores
            let wordList = DB[category] || [];
            
            // Se a lista for pequena (< 6), tenta duplicar ou adicionar placeholders para n√£o quebrar
            if(wordList.length < 5) wordList = [...wordList, ...wordList]; 

            const gridEl = document.getElementById('crosswordGrid');
            const listH = document.getElementById('listH');
            const listV = document.getElementById('listV');
            
            gridEl.innerHTML = ''; listH.innerHTML = ''; listV.innerHTML = '';
            gridEl.style.gridTemplateColumns = `repeat(${GRID_SIZE}, var(--cell-size))`;

            let success = false;
            for(let i=0; i<50; i++) {
                if(tryCreateGrid(wordList)) { success = true; break; }
            }

            if(!success) {
                alert("N√£o foi poss√≠vel gerar um layout perfeito. Tente novamente.");
                return;
            }

            renderGrid(gridEl);
            renderClues(listH, listV);
            renderAnswers();
        }

        function tryCreateGrid(words) {
            gridArray = Array(GRID_SIZE).fill(null).map(() => Array(GRID_SIZE).fill(null));
            placedWords = [];
            
            // Ordena por tamanho decrescente
            const sortedWords = [...words].sort((a,b) => b.t.length - a.t.length);
            
            // Coloca a primeira
            const first = sortedWords[0];
            const r = Math.floor(GRID_SIZE/2);
            const c = Math.floor((GRID_SIZE - first.t.length)/2);
            placeWord(first, r, c, 'H');

            for(let i=1; i<sortedWords.length; i++) {
                findSpot(sortedWords[i]);
            }

            return placedWords.length >= Math.min(sortedWords.length, 5);
        }

        function findSpot(word) {
            const text = word.t;
            const spots = [];

            for(let i=0; i<text.length; i++) {
                const char = text[i];
                for(let r=0; r<GRID_SIZE; r++) {
                    for(let c=0; c<GRID_SIZE; c++) {
                        if(gridArray[r][c] === char) {
                            if(canPlace(text, r-i, c, 'V')) spots.push({r:r-i, c:c, dir:'V'});
                            if(canPlace(text, r, c-i, 'H')) spots.push({r:r, c:c-i, dir:'H'});
                        }
                    }
                }
            }

            if(spots.length > 0) {
                const s = spots[Math.floor(Math.random() * spots.length)];
                placeWord(word, s.r, s.c, s.dir);
            }
        }

        function canPlace(word, row, col, dir) {
            if(row<0 || col<0) return false;
            if(dir === 'H' && col + word.length > GRID_SIZE) return false;
            if(dir === 'V' && row + word.length > GRID_SIZE) return false;

            for(let i=0; i<word.length; i++) {
                let r = row + (dir === 'V' ? i : 0);
                let c = col + (dir === 'H' ? i : 0);
                const current = gridArray[r][c];

                if(current !== null && current !== word[i]) return false;
                
                // Vizinhos (exceto intersec√ß√£o)
                if(current === null) {
                    if(dir === 'H') {
                        if(r>0 && gridArray[r-1][c]!==null) return false;
                        if(r<GRID_SIZE-1 && gridArray[r+1][c]!==null) return false;
                        // Pontas
                        if(i===0 && c>0 && gridArray[r][c-1]!==null) return false;
                        if(i===word.length-1 && c<GRID_SIZE-1 && gridArray[r][c+1]!==null) return false;
                    } else {
                        if(c>0 && gridArray[r][c-1]!==null) return false;
                        if(c<GRID_SIZE-1 && gridArray[r][c+1]!==null) return false;
                        // Pontas
                        if(i===0 && r>0 && gridArray[r-1][c]!==null) return false;
                        if(i===word.length-1 && r<GRID_SIZE-1 && gridArray[r+1][c]!==null) return false;
                    }
                }
            }
            return true;
        }

        function placeWord(word, r, c, dir) {
            for(let i=0; i<word.t.length; i++) {
                let cr = r + (dir === 'V' ? i : 0);
                let cc = c + (dir === 'H' ? i : 0);
                gridArray[cr][cc] = word.t[i];
            }
            placedWords.push({...word, r, c, dir, num: placedWords.length+1});
        }

        function renderGrid(el) {
            // Mapa de n√∫meros
            const nums = {};
            placedWords.forEach(w => nums[`${w.r},${w.c}`] = w.num);

            for(let r=0; r<GRID_SIZE; r++) {
                for(let c=0; c<GRID_SIZE; c++) {
                    const char = gridArray[r][c];
                    const div = document.createElement('div');
                    
                    if(char) {
                        div.className = 'cell active';
                        div.innerHTML = `
                            <input type="text" maxlength="1" data-char="${char}" onkeyup="this.value=this.value.toUpperCase(); check()">
                            ${nums[`${r},${c}`] ? `<span class="cell-num">${nums[`${r},${c}`]}</span>` : ''}
                        `;
                    } else {
                        div.className = 'cell';
                    }
                    el.appendChild(div);
                }
            }
        }

        function renderClues(h, v) {
            placedWords.forEach(w => {
                const item = `<div class="clue-item"><strong>${w.num}.</strong> ${w.d}</div>`;
                if(w.dir === 'H') h.innerHTML += item;
                else v.innerHTML += item;
            });
        }

        function check() {
            const inputs = document.querySelectorAll('.cell.active input');
            let all = true;
            inputs.forEach(i => {
                i.parentElement.classList.remove('correct', 'wrong');
                if(i.value) {
                    if(i.value === i.dataset.char) i.parentElement.classList.add('correct');
                    else { i.parentElement.classList.add('wrong'); all = false; }
                } else all = false;
            });
            if(all) {
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                alert("Parab√©ns! Cruzadinha completa!");
            }
        }

        function renderAnswers() {
            const list = document.getElementById('answersList');
            list.innerHTML = placedWords.map(w => `<div><strong>${w.num}. ${w.t}</strong>: ${w.d}</div>`).join('');
        }

        // Init
        window.onload = generateGame;
    </script>
</body>
</html>
